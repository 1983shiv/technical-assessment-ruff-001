## ðŸ“˜ Problem Statement

**Business Context:**
You are working for an e-commerce company. The product team wants to improve the shopping cart experience by allowing users to update item quantities directly in the cart sidebar, with real-time validation and feedback. The cart should use React Context for state management. The UI must handle edge cases such as stock limits, invalid input, and empty cart states.

**Feature Requirement:**
Implement a `CartSidebar` React component that displays cart items, allows quantity updates, and provides instant feedback for invalid actions (e.g., exceeding stock, entering non-numeric values, or setting quantity to zero). The cart state is managed via React Context. The component should be accessible and responsive.

---

## ðŸ§© Code Skeleton

```tsx
// CartContext.tsx
import React, { createContext, useContext, useState, ReactNode } from 'react';

export type CartItem = {
  id: string;
  name: string;
  price: number;
  quantity: number;
  stock: number;
};

type CartContextType = {
  items: CartItem[];
  updateQuantity: (id: string, quantity: number) => void;
  removeItem: (id: string) => void;
};

const CartContext = createContext<CartContextType | undefined>(undefined);

export const useCart = () => {
  const ctx = useContext(CartContext);
  if (!ctx) throw new Error('useCart must be used within CartProvider');
  return ctx;
};

export const CartProvider = ({ children }: { children: ReactNode }) => {
  // TODO: Initialize with some mock items
  const [items, setItems] = useState<CartItem[]>([]);

  const updateQuantity = (id: string, quantity: number) => {
    // TODO: Implement quantity update with validation (stock, min 1, numeric)
  };

  const removeItem = (id: string) => {
    // TODO: Remove item from cart
  };

  return (
    <CartContext.Provider value={{ items, updateQuantity, removeItem }}>
      {children}
    </CartContext.Provider>
  );
};
```

```tsx
// CartSidebar.tsx
import React, { useState } from 'react';
import { useCart } from './CartContext';

const CartSidebar = () => {
  const { items, updateQuantity, removeItem } = useCart();
  const [errors, setErrors] = useState<Record<string, string>>({});

  if (items.length === 0) {
    return <div role="alert">Your cart is empty.</div>;
  }

  return (
    <aside aria-label="Shopping cart">
      <ul>
        {items.map(item => (
          <li key={item.id}>
            <span>{item.name}</span>
            <input
              type="number"
              min={1}
              max={item.stock}
              value={item.quantity}
              aria-label={`Quantity for ${item.name}`}
              onChange={e => {
                // TODO: Validate and update quantity, set error if invalid
              }}
            />
            <button onClick={() => removeItem(item.id)} aria-label={`Remove ${item.name}`}>Remove</button>
            {errors[item.id] && <div role="alert" style={{ color: 'red' }}>{errors[item.id]}</div>}
          </li>
        ))}
      </ul>
      <div>Total: $ {/* TODO: Calculate total */}</div>
    </aside>
  );
};

export default CartSidebar;
```

---

## âœ… Testing Expectations

Write tests using **Jest + React Testing Library** to cover:

- Rendering cart items and empty state
- Updating quantity (valid and invalid: over stock, zero, negative, non-numeric)
- Removing items
- Error messages for invalid actions
- Accessibility (aria-labels, role="alert")
- Edge cases: last item removed, rapid input changes

### Example Test File

```tsx
// CartSidebar.test.tsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { CartProvider } from './CartContext';
import CartSidebar from './CartSidebar';

const mockItems = [
  { id: '1', name: 'T-shirt', price: 20, quantity: 2, stock: 5 },
  { id: '2', name: 'Sneakers', price: 50, quantity: 1, stock: 2 },
];

function setup(items = mockItems) {
  // Custom provider for test
  return render(
    <CartProvider>
      <CartSidebar />
    </CartProvider>
  );
}

test('renders cart items', () => {
  setup();
  expect(screen.getByText('T-shirt')).toBeInTheDocument();
  expect(screen.getByText('Sneakers')).toBeInTheDocument();
});

test('shows empty state', () => {
  setup([]);
  expect(screen.getByRole('alert')).toHaveTextContent('Your cart is empty');
});

test('updates quantity with valid value', () => {
  setup();
  const input = screen.getByLabelText('Quantity for T-shirt');
  fireEvent.change(input, { target: { value: '3' } });
  // TODO: Assert quantity updated, no error
});

test('shows error for quantity over stock', () => {
  setup();
  const input = screen.getByLabelText('Quantity for T-shirt');
  fireEvent.change(input, { target: { value: '10' } });
  expect(screen.getByRole('alert')).toHaveTextContent(/stock/i);
});

test('removes item from cart', () => {
  setup();
  const removeBtn = screen.getByLabelText('Remove T-shirt');
  fireEvent.click(removeBtn);
  // TODO: Assert item removed
});

// ...more tests for edge cases, accessibility, rapid input, etc.
```

---

## ðŸ’¡ Optional Bonus

- Optimize re-renders for large carts (React.memo, useCallback)
- Add keyboard navigation and focus management
- Show loading state for async updates
- Responsive design for mobile
- Handle API/network errors gracefully
- Add undo for remove action
ECHO is on.
